import{C as Pt,D as Mt,E as qt,J as zt,L as Ht,O as Ut,a as Rt,d as kt,e as At,h as K,i as $,j as je,k as Lt,q as Gt,s as $t,y as Nt}from"./chunk-XSXN2WEW.js";import{a as Qt}from"./chunk-DJZJGHML.js";import{Cc as Ot,Ga as J,Ja as Dt,Lc as Et,Oa as xt,Pa as It,Pc as U,Qa as wt,Xa as Vt,bb as jt,id as W}from"./chunk-I4UUC3YQ.js";import{K as ct,N as pt,S as ft,V as A,Z as ut,ba as ht,ca as _t,da as gt}from"./chunk-O46BWIIH.js";import{$ as ne,$b as ue,$g as Se,Ab as w,Ad as H,Ca as M,Db as g,Fb as f,Fc as st,Ff as _e,Fg as ge,G as ze,K as He,L as N,La as s,Lb as fe,Ma as y,Mb as z,Na as Je,Nb as V,Ng as be,Ob as j,Og as Ce,Rh as bt,Sg as dt,Tb as Y,Tf as lt,Ub as it,Uh as Ct,V as oe,Vb as rt,Vh as we,X as Ue,Xa as q,Xh as yt,Zg as ye,_g as Fe,_h as Ft,a as G,aa as We,ac as k,ah as ve,b as Ae,ba as Ke,bb as Q,bc as Ge,cc as ot,ch as mt,ci as St,da as Xe,db as le,di as vt,ea as v,eb as F,fh as Te,fi as Tt,g as _,h as X,hb as d,hh as Be,ib as de,ja as I,jb as Ze,k as Le,ka as R,kc as u,kh as De,l as ie,la as Ye,lc as h,ma as T,mc as nt,n as Me,oi as Ve,pb as B,ph as xe,pi as Bt,ra as b,rb as me,rh as Ie,sa as C,sb as ce,tb as pe,u as qe,ub as l,uc as he,va as ae,vb as c,wb as S,xa as se,xb as et,xc as O,y as re,ya as P,yb as tt,yc as at,z as Qe}from"./chunk-BLDJGFEP.js";var L=(()=>{let i=class i{constructor(e){this._fgService=e,this._customFilterConditions=new Map}addCustomFilter(e){if(!e.conditionComponent&&e.rendererComponent&&(e.conditionComponent=e.rendererComponent),!e.conditionComponent)return!1;let t=this._fgService.addComponent(e.conditionComponent,e.types);return t&&this._customFilterConditions.set(e.conditionComponent,e),t&&e.rendererComponent&&this._fgService.addComponent(e.rendererComponent,e.types.map(r=>`${r}-renderer`)),t}getCustomFilterConfiguration(e){let t=this._fgService.getComponentDefinitionByType(e);if(t)return this._customFilterConditions.get(t.component)}getApplicableFilterConditions(e,t=$.STRING){let r=this._fgService.getComponentDefinitionByType(e),n=Lt(t);return r&&this._customFilterConditions.get(r.component)?.filterStrategies||n}getDisplayValue(e,t){return _(this,null,function*(){let r=this.getCustomFilterConfiguration(t);if(r?.valueRenderer){let p=r?.valueRenderer(e),x=lt(p),E;return yield x.createSubscription(p,Xt=>{E=Xt}),E}let n=this._normalizeValue(e.value),m=this._normalizeValue(e.value2);switch(e.operator){case"equalTo":return`=${n}`;case"contains":return`*${n}*`;case"between":return`${n}...${m}`;case"beginsWith":return`${n}*`;case"endsWith":return`*${n}`;case"greaterThan":return`>${n}`;case"greaterThanOrEqualTo":return`>=${n}`;case"lessThan":return`<${n}`;case"lessThanOrEqualTo":return`<=${n}`;case"after":return`>${n}`;case"onOrAfter":return`>=${n}`;case"before":return`<${n}`;case"beforeOrOn":return`<=${n}`;default:return`${n}`}})}normalizeConditions(e,t){return _(this,null,function*(){let r=[];for(let n of t){let m=Object.assign({},n);m.displayValue=yield this.getDisplayValue(m,e.guiOptions?.additionalData.type),r.push(m)}return r})}getConditionFieldSelectedVariants(e,t){return _(this,null,function*(){return(yield this.normalizeConditions(e,t)).map(r=>J(r)?r:{label:r.displayValue,value:r})})}transformCollectionFilter(e){return e.filters.map(t=>({operator:t.strategy,value:t.value,value2:t.value2}))}_normalizeValue(e){return Array.isArray(e)?e.map(t=>this._normalizeValue(t)).join(", "):J(e)?e.label:e instanceof jt?e.toDateString():e}};i.\u0275fac=function(t){return new(t||i)(Xe(U))},i.\u0275prov=We({token:i,factory:i.\u0275fac});let o=i;return o})();function Z(o){return Array.isArray(o)&&(o=o.map(i=>Z(i))),J(o)?o.value:o}function ei(o,i){if(o&1&&(l(0,"div",4)(1,"fd-bar-element")(2,"h4",5),Y(3),c()()()),o&2){let a=f();s(2),d("headerSize",4),s(),it(a.config.header)}}function ti(o,i){if(o&1){let a=w();l(0,"fd-layout-grid")(1,"div",6)(2,"div",7)(3,"fdp-form-generator",10),g("formSubmitted",function(t){b(a);let r=f(2);return C(r._onFormSubmitted(t))}),c()(),l(4,"div",11)(5,"button",12),u(6,"fdTranslate"),g("click",function(){let t=b(a).$index,r=f(2);return C(r.removeCondition(t))}),c()()()()}if(o&2){let a=i.$implicit;s(3),d("formItems",a)("unifiedLayout",!1)("noAdditionalContent",!0),s(2),d("title",h(6,4,"platformSmartFilterBar.defineConditionsRemoveConditionButtonTitle"))}}function ii(o,i){if(o&1){let a=w();l(0,"form"),ce(1,ti,7,6,"fd-layout-grid",null,me),l(3,"fd-layout-grid")(4,"div",6)(5,"div",7),Y(6,"\xA0"),c(),l(7,"div",8)(8,"button",9),u(9,"fdTranslate"),g("click",function(){b(a);let t=f();return C(t.addCondition())}),c()()()()()}if(o&2){let a=f();s(),pe(a._formItems),s(7),d("label",h(9,1,"platformSmartFilterBar.defineConditionsAddConditionButtonLabel"))}}function ri(o,i){o&1&&(l(0,"div"),S(1,"fd-busy-indicator",13),c()),o&2&&(de("text-align","center")("margin",1,"rem"),s(),d("loading",!0))}var Oe=(()=>{let i=class i{constructor(e,t,r){this._dialogRef=e,this._cdr=t,this._smartFilterBarService=r,this.conditionOperatorOptions=[],this._formItems=[],this.loaded=!1,this._conditionLabelKeys={contains:"filterConditionContains",equalTo:"filterConditionEqualTo",between:"filterConditionBetween",beginsWith:"filterConditionBeginsWith",endsWith:"filterConditionEndsWith",lessThan:"filterConditionLessThan",lessThanOrEqualTo:"filterConditionLessThanOrEqualTo",greaterThan:"filterConditionGreaterThan",greaterThanOrEqualTo:"filterConditionGreaterThanOrEqualTo",after:"filterConditionAfter",onOrAfter:"filterConditionOnOrAfter",before:"filterConditionBefore",beforeOrOn:"filterConditionBeforeOrOn"},this._submittedForms=[],this.resolveTranslation=ft(),this._init()}addCondition(){this._formItems.push(this._generateFormGeneratorItems())}removeCondition(e){this._formItems.splice(e,1),this._formItems.length===0&&this.addCondition()}applyConditions(){this._cdr.detectChanges(),this._submittedForms=[],this.formGenerators.toArray().forEach(e=>e.submit())}_onFormSubmitted(e){if(this._submittedForms.push(e),this._submittedForms.length!==this.formGenerators.length)return;let t=this._submittedForms.map(r=>(r.value=r.value1!==void 0?r.value1:r.value,r));this._dialogRef.close(t.filter(r=>r.value!==void 0&&r.value!==null))}_cancel(){this._dialogRef.dismiss()}_init(){this.config=this._dialogRef.data,this.conditionOperatorOptions=this._getApplicableConditionOperators(),this._addExistingConditions(Z(this.config.conditions)),this.config.conditions.length===0&&this.addCondition(),this.loaded=!0,this._cdr.markForCheck()}_getApplicableConditionOperators(){let e=this._smartFilterBarService.getApplicableFilterConditions(this.config.filterType,this.config.dataType),t=G({},this._conditionLabelKeys);for(let r of Object.keys(this._conditionLabelKeys)){let n="platformSmartFilterBar."+t[r];t[r]=this.resolveTranslation(n)}return e.map(r=>({label:t[r],value:r}))}_addExistingConditions(e){e.forEach(t=>{let r=this._generateFormGeneratorItems(t);this._formItems.push(r)})}_generateFormGeneratorItems(e){return[{name:"operator",message:"operator",default:e?this.conditionOperatorOptions.find(t=>t.value===e.operator)?.value:this.conditionOperatorOptions[0].value,type:"select",choices:this.conditionOperatorOptions,required:!0,guiOptions:{inline:!1,column:1,noLabelLayout:!0}},{name:"value",message:"value",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValuePlaceholder"),controlType:this.config.controlType,when:t=>t.operator!==je.BETWEEN,onchange:(t,r,n)=>{n.parent?.get("value1")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value1",message:"value1",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueFromPlaceholder"),controlType:this.config.controlType,when:t=>t.operator===je.BETWEEN,onchange:(t,r,n)=>{n.parent?.get("value")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value2",message:"value2",default:e?.value2,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueToPlaceholder"),required:!0,controlType:this.config.controlType,when:t=>t?.operator===je.BETWEEN,guiOptions:{inline:!1,column:3,noLabelLayout:!0}}]}};i.\u0275fac=function(t){return new(t||i)(y(be),y(he),y(L))},i.\u0275cmp=R({type:i,selectors:[["fdp-smart-filter-bar-conditions-dialog"]],viewQuery:function(t,r){if(t&1&&z(W,5),t&2){let n;V(n=j())&&(r.formGenerators=n)}},standalone:!0,features:[k],decls:11,vars:7,consts:[[1,"fdp-smart-filter-bar__conditions-dialog"],["fdkTemplate","header"],["fdType","emphasized",3,"click","label"],["fdType","transparent",3,"click","label"],["fd-bar-left",""],["fd-title","",3,"headerSize"],["fdLayoutGridRow",""],["colGrow","","fdLayoutGridCol",""],["fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],["fd-button","",3,"click","label"],["columnLayout","XL3-L3-M3-S3",3,"formSubmitted","formItems","unifiedLayout","noAdditionalContent"],["colGrow","","fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],["fd-button","","fdType","transparent","glyph","decline","type","button",3,"click","title"],[3,"loading"]],template:function(t,r){t&1&&(l(0,"fd-dialog",0)(1,"fd-dialog-header"),F(2,ei,4,2,"ng-template",1),c(),l(3,"fd-dialog-body"),F(4,ii,10,3,"form")(5,ri,2,5),c(),l(6,"fd-dialog-footer")(7,"fd-button-bar",2),u(8,"fdTranslate"),g("click",function(){return r.applyConditions()}),c(),l(9,"fd-button-bar",3),u(10,"fdTranslate"),g("click",function(){return r._cancel()}),c()()()),t&2&&(s(4),B(4,r.loaded?4:5),s(3),d("label",h(8,3,"platformSmartFilterBar.defineConditionsSubmitButtonLabel")),s(2),d("label",h(10,5,"platformSmartFilterBar.defineConditionsCancelButton")))},dependencies:[xe,De,_e,ve,Se,Be,Ce,Ve,Ft,we,yt,wt,It,xt,W,ye,Te,Fe,ge,A],encapsulation:2,changeDetection:0});let o=i;return o})();var Kt=(()=>{let i=class i extends Vt{constructor(){super(...arguments),this._dialogService=v(Ie),this._smartFilterBarService=v(L),this._injector=v(se),this.openConditionsDialog=()=>{let e=this.getField().value,t={header:this.formItem.message,dataType:this.formItem.guiOptions?.additionalData.dataType,filterType:this.formItem.guiOptions?.additionalData.type,conditions:e||[],choices:this.formItem.guiOptions?.additionalData.choices,controlType:this.formItem.guiOptions?.additionalData.controlType};this._dialogService.open(Oe,{data:t,width:"67.5rem",minHeight:"30%"},this._injector).afterClosed.pipe(N(1)).subscribe({next:n=>_(this,null,function*(){let m=this.getField(),p=yield this._smartFilterBarService.getConditionFieldSelectedVariants(this.formItem,n);m.setValue(p)}),error:n=>{}})}}getField(){return this.form.get(`${this.formGroupName}.${this.name}`)}};i.\u0275fac=(()=>{let e;return function(r){return(e||(e=ae(i)))(r||i)}})(),i.\u0275dir=T({type:i,features:[Q]});let o=i;return o})();var $e=(()=>{let i=class i{constructor(){this.conditionStrategy="or",this.smartFilterBarFilterable=!0,this.required=!1,this.defaultSelected=!1,this.hasOptions=!1}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=T({type:i,selectors:[["","fdpSmartFilterBarFieldDefinition",""],["","fdp-smart-filter-bar-field-definition",""]],inputs:{key:"key",name:"name",label:"label",filterType:"filterType",dataType:"dataType",customFilterType:"customFilterType",conditionStrategy:"conditionStrategy",smartFilterBarFilterable:[I.HasDecoratorInputTransform,"smartFilterBarFilterable","smartFilterBarFilterable",O],required:[I.HasDecoratorInputTransform,"required","required",O],defaultSelected:[I.HasDecoratorInputTransform,"defaultSelected","defaultSelected",O],hasOptions:[I.HasDecoratorInputTransform,"hasOptions","hasOptions",O]},standalone:!0,features:[le]});let o=i;return o})();var oi=(()=>{let i=class i{constructor(e){this._subject=e,this._fieldDefinitionsSubject=new ie([]),this.fieldsStream=this._fieldDefinitionsSubject.asObservable(),this._destroyRef=v(P)}ngAfterViewInit(){this._fieldDefinitions.changes.pipe(oe(null),H(this._destroyRef)).subscribe(()=>{this._fieldDefinitionsSubject.next(this._fieldDefinitions.map(e=>this._transformSubjectField(e)))})}getDataSource(){return this._subject.getDataSource()}getSubjectFields(){return this._fieldDefinitions.toArray().map(e=>this._transformSubjectField(e))}getFieldVariants(e){return this.getDataSource().dataProvider.getFieldOptions(e)}getDefaultFields(){return this.getSubjectFields()?.filter(e=>e.filterable&&e.defaultSelected).map(e=>e.name)}getState(){return this._subject.getTableState()}getSubject(){return this._subject}_transformSubjectField(e){return{key:e.key,name:e.name,label:e.label,filterType:e.filterType,filterable:e.smartFilterBarFilterable,dataType:e.dataType,required:e.required,customFilterType:e.customFilterType,defaultSelected:e.defaultSelected,hasOptions:e.hasOptions,conditionStrategy:e.conditionStrategy}}};i.\u0275fac=function(t){return new(t||i)(y(Rt))},i.\u0275dir=T({type:i,selectors:[["","fdpSmartFilterBarSubject",""],["","fdp-smart-filter-bar-subject",""]],contentQueries:function(t,r,n){if(t&1&&fe(n,$e,4),t&2){let m;V(m=j())&&(r._fieldDefinitions=m)}},exportAs:["fdp-smart-filter-bar-subject"],standalone:!0});let o=i;return o})();var Ne=(()=>{let i=class i{constructor(e){this.templateRef=e}};i.\u0275fac=function(t){return new(t||i)(y(Je))},i.\u0275dir=T({type:i,selectors:[["","fdpSmartFilterBarToolbarItem",""]],standalone:!0});let o=i;return o})();var ni=()=>[],ai=()=>["submitted"],Ee=(()=>{let i=class i extends Kt{};i.\u0275fac=(()=>{let e;return function(r){return(e||(e=ae(i)))(r||i)}})(),i.\u0275cmp=R({type:i,selectors:[["fdp-smart-filter-bar-condition-field"]],standalone:!0,features:[Q,k],decls:4,vars:14,consts:[[3,"formGroup"],[3,"formGroupName"],["displayKey","displayValue",3,"id","addOnButtonClickFn","dataSource","formControlName","name","placeholder","validationStrategy","glyphAriaLabel"]],template:function(t,r){t&1&&(et(0,0)(1,1),S(2,"fdp-multi-input",2),u(3,"fdTranslate"),tt()()),t&2&&(d("formGroup",r.form),s(),d("formGroupName",r.formGroupName),s(),d("id",r.id)("addOnButtonClickFn",r.openConditionsDialog)("dataSource",r.formItem.choices||Ge(12,ni))("formControlName",r.name)("name",r.name)("placeholder",r.formItem.placeholder||r.formItem.message)("validationStrategy",Ge(13,ai))("glyphAriaLabel",h(3,10,"platformSmartFilterBar.manageFieldConditions")))},dependencies:[Ve,Ct,we,Bt,St,Tt,vt,Ot,A],encapsulation:2});let o=i;return o})();var Re=class extends $t{constructor(i){super(i)}filter(i){let a;switch(i){case"visible":a=this._getVisibleItems();break;case"active":a=this._getActiveItems();break;case"visibleAndActive":a=this._getVisibleAndActiveItems();break;case"mandatory":a=this._getMandatoryItems();break;case"all":default:a=this._getAllItems();break}this.items$.next(a)}_getAllItems(){return this.items}_getVisibleItems(){return this.items.filter(i=>i.visible)}_getActiveItems(){return this.items.filter(i=>i.active)}_getVisibleAndActiveItems(){return this.items.filter(i=>i.visible||i.active)}_getMandatoryItems(){return this.items.filter(i=>i.mandatory)}};var si=["table"];function li(o,i){o&1&&(l(0,"div",6)(1,"fd-bar-element")(2,"h4",7),Y(3),u(4,"fdTranslate"),c()()(),l(5,"div",8)(6,"fd-bar-element"),S(7,"fdp-table-reset-button"),c()()),o&2&&(s(2),d("headerSize",4),s(),rt(" ",h(4,2,"platformSmartFilterBar.selectFiltersHeader")," "))}function di(o,i){o&1&&S(0,"fd-icon",15)}function mi(o,i){if(o&1&&(l(0,"fdp-table-cell"),F(1,di,1,0,"fd-icon",15),c()),o&2){let a=i.$implicit;s(),B(1,a.active?1:-1)}}function ci(o,i){if(o&1){let a=w();l(0,"fdp-table",9,0),g("rowSelectionChange",function(t){b(a);let r=f();return C(r._onRowSelectionChange(t))}),l(2,"fdp-table-toolbar",10),u(3,"fdTranslate"),l(4,"fdp-table-toolbar-actions")(5,"fdp-select",11),g("selectionChange",function(t){b(a);let r=f();return C(r._onFilterVisibilityChange(t))}),c()()(),S(6,"fdp-column",12),u(7,"fdTranslate"),l(8,"fdp-column",13),u(9,"fdTranslate"),F(10,mi,2,1,"fdp-table-cell",14),c()()}if(o&2){let a=f();d("dataSource",a.source),s(2),d("hideItemCount",!1)("title",h(3,7,"platformSmartFilterBar.selectFiltersAvailableFiltersText")),s(3),d("list",a._filterVisibilityOptions)("value",a._filterVisibilityOptions[0].value),s(),d("label",h(7,9,"platformSmartFilterBar.selectFiltersFilterColumnLabel")),s(2),d("label",h(9,11,"platformSmartFilterBar.selectFiltersActiveColumnLabel"))}}function pi(o,i){o&1&&(l(0,"div"),S(1,"fd-busy-indicator",16),c()),o&2&&(de("text-align","center")("margin",1,"rem"),s(),d("loading",!0))}var ke=(()=>{let i=class i{constructor(e,t,r){this._dialogRef=e,this._language$=t,this._cdr=r,this._filterVisibilityOptions=[],this.loaded=!1,this.isResetAvailable$=q(!1),this._categoryLabelKeys={all:"settingsCategoryAll",visible:"settingsCategoryVisible",active:"settingsCategoryActive",visibleAndActive:"settingsCategoryVisibleAndActive",mandatory:"settingsCategoryMandatory"},this._selectedFilters=[],this._destroyRef=v(P),this._translationResolver=new pt,this.setInitialTableState(),this._init()}ngAfterViewInit(){this.setSelectedFilters()}setSelectedFilters(){this._sourceSubscription?.unsubscribe(),this._sourceSubscription=this.source.open().pipe(qe(Me),H(this._destroyRef)).subscribe(e=>{e.forEach((t,r)=>{t.visible&&this.table.toggleSelectableRow(r)})})}reset(){this.setInitialTableState(),this.setSelectedFilters()}setInitialTableState(){this._availableFields=this._dialogRef.data.fields.filter(e=>e.filterable).map(e=>({label:e.label,active:!!this._dialogRef.data.filterBy.find(t=>t.field===e.name),mandatory:e.required,visible:this._dialogRef.data.selectedFilters.includes(e.name),key:e.key,name:e.name})),this.source=new Gt(new Re(this._availableFields))}_cancel(){this._dialogRef.dismiss()}_confirm(){this._dialogRef.close(this._selectedFilters)}_onRowSelectionChange(e){this._selectedFilters=e.selection.map(t=>t.name),this.isResetAvailable$.set(!0)}_onFilterVisibilityChange(e){this.table&&(this.source.dataProvider.filter(e.payload),this.source.fetch(this.table.getTableState()))}_init(){return _(this,null,function*(){yield this._transformVisibilityLabels(),this.loaded=!0,this._cdr.markForCheck()})}_transformVisibilityLabels(){return _(this,null,function*(){let e=yield re(this._language$),t=G({},this._categoryLabelKeys);for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n="platformSmartFilterBar."+t[r];t[r]=this._translationResolver.resolve(e,n)}for(let[r,n]of Object.entries(t))this._filterVisibilityOptions.push({label:n,value:r})})}};i.\u0275fac=function(t){return new(t||i)(y(be),y(ct),y(he))},i.\u0275cmp=R({type:i,selectors:[["fdp-smart-filter-bar-settings-dialog"]],viewQuery:function(t,r){if(t&1&&z(si,5),t&2){let n;V(n=j())&&(r.table=n.first)}},standalone:!0,features:[ue([{provide:Pt,useExisting:i}]),k],decls:11,vars:7,consts:[["table",""],[1,"fdp-table-p13-filtering-dialog"],["fdkTemplate","header"],["selectionMode","multiple"],["fdType","emphasized",3,"click","label"],["fdType","transparent",3,"click","label"],["fd-bar-left",""],["fd-title","",3,"headerSize"],["fd-bar-right",""],["selectionMode","multiple",3,"rowSelectionChange","dataSource"],[3,"hideItemCount","title"],[3,"selectionChange","list","value"],["align","start","key","label","name","label",3,"label"],["align","center","key","active","name","active","width","150px",3,"label"],[4,"fdpCellDef"],["glyph","accept"],[3,"loading"]],template:function(t,r){t&1&&(l(0,"fd-dialog",1)(1,"fd-dialog-header"),F(2,li,8,4,"ng-template",2),c(),l(3,"fd-dialog-body"),F(4,ci,11,13,"fdp-table",3)(5,pi,2,5),c(),l(6,"fd-dialog-footer")(7,"fd-button-bar",4),u(8,"fdTranslate"),g("click",function(){return r._confirm()}),c(),l(9,"fd-button-bar",5),u(10,"fdTranslate"),g("click",function(){return r._cancel()}),c()()()),t&2&&(s(4),B(4,r.loaded?4:5),s(3),d("label",h(8,3,"platformSmartFilterBar.selectFiltersSubmitButtonLabel")),s(2),d("label",h(10,5,"platformSmartFilterBar.selectFiltersCancelButton")))},dependencies:[xe,De,_e,ve,Se,Be,mt,Mt,Ce,Ut,Nt,Ht,zt,Et,qt,At,kt,dt,Te,Fe,ge,A],encapsulation:2,changeDetection:0});let o=i;return o})();var Pe="smart-filter-condition-renderer";var ee=(()=>{let i=class i{constructor(){this.name="platformSmartFilterBar",this.presetChanged=new M}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=T({type:i,inputs:{name:"name"},outputs:{presetChanged:"presetChanged"}});let o=i;return o})();var fi=o=>({filtersCount:o});function ui(o,i){}function hi(o,i){if(o&1&&(F(0,ui,0,0,"ng-template",7),S(1,"fd-toolbar-separator")),o&2){let a=i.$implicit;d("ngTemplateOutlet",a)}}function _i(o,i){if(o&1&&ce(0,hi,2,1,null,null,me),o&2){let a=f(2);pe(a._toolbarItems)}}function gi(o,i){if(o&1){let a=w();l(0,"button",8),u(1,"fdTranslate"),g("click",function(){b(a);let t=f(2);return C(t.submitForm())}),c()}if(o&2){let a=f(2);d("disabled",a.loading)("label",h(1,2,"platformSmartFilterBar.submitButtonLabel"))}}function bi(o,i){if(o&1){let a=w();l(0,"fd-toolbar",0),F(1,_i,2,0),l(2,"fdp-search-field",2),u(3,"fdTranslate"),g("inputChange",function(t){b(a);let r=f();return C(r.onSearchInputChange(t))})("searchSubmit",function(){b(a);let t=f();return C(t.submitForm())})("cancelSearch",function(){b(a);let t=f();return C(t.cancelSearch())}),c(),S(4,"fd-toolbar-spacer"),F(5,gi,2,4,"button",3),l(6,"button",4),u(7,"fdTranslate"),g("click",function(){b(a);let t=f();return C(t.submitForm())}),c(),l(8,"button",5),u(9,"fdTranslate"),g("click",function(){b(a);let t=f();return C(t.showFilteringSettings())}),c(),l(10,"button",6),u(11,"fdTranslate"),g("click",function(){b(a);let t=f();return C(t.toggleFilterBar())}),c()()}if(o&2){let a=f();s(),B(1,a._toolbarItems?1:-1),s(),d("disabled",a.loading)("disableRefresh",!0)("placeholder",h(3,11,"platformSmartFilterBar.searchPlaceholder")),s(3),B(5,a.liveUpdate?-1:5),s(),d("disabled",a.loading)("ariaLabel",h(7,13,"platformSmartFilterBar.refreshButtonAriaLabel")),s(2),d("label",nt(9,15,"platformSmartFilterBar.filtersButtonLabel",ot(20,fi,a.selectedFiltersCount$())))("disabled",a.loading),s(2),d("label",h(11,18,a.showFilterBar$()?"platformSmartFilterBar.hideFiltersButtonLabel":"platformSmartFilterBar.showFiltersButtonLabel"))("disabled",a.loading)}}function Ci(o,i){if(o&1){let a=w();l(0,"div",9)(1,"fdp-form-generator",10),g("formCreated",function(){b(a);let t=f();return C(t._onFormCreated())})("formSubmitted",function(t){b(a);let r=f();return C(r._onFormSubmitted(t))}),c()()}if(o&2){let a=f();d("hidden",!a.showFilterBar$()),s(),d("noAdditionalContent",!0)("formItems",i)("columnLayout",a.filtersColumnLayout)}}var yi="XL4-L3-M2-S1";function Fi(o){return Math.max(...o.split("-").map(i=>{let a=i.match(/\d+/);return a?parseInt(a[0],10):1}))}var Si={responsivePadding:!0,verticalPadding:!0,minWidth:"30rem",bodyMinHeight:"calc(50vh - 5.5rem)"},vi={provide:ee,useExisting:ne(()=>te)},te=(()=>{let i=class i extends ee{set subject(e){this._setSubject(e)}get subject(){return this._subject}get loading(){return this._subject?.getDataSource()?this._subject.getDataSource().isDataLoading:!0}constructor(e,t,r,n){super(),this._dialogService=e,this._fgService=t,this._injector=r,this._destroyRef=n,this.transparent=!1,this.filtersColumnLayout=yi,this.liveUpdate=!1,this.hideToolbar=!1,this.smartFiltersChanged=new M,this.smartFiltersApplied=new M,this.searchInputChanged=new M,this.filterBy=[],this.showFilterBar$=q(!0),this._toolbarItems=[],this._formItems=q(null),this.selectedFilters$=q([]),this.selectedFiltersCount$=at(()=>this.selectedFilters$().length),this._subscriptions=new X,this._subjectSubscriptions=new X,this._formGeneratorReady=new ie(!1),this._ignorePresetChange=!1,this._refresh$=new Le,this._smartFilterBarService=v(L,{optional:!0,skipSelf:!0})??v(L,{self:!0}),this._fgService.addComponent(Ee,[Pe])}ngAfterViewInit(){this._subscriptions.add(this._toolbarItemRefs.changes.pipe(oe(null)).subscribe(()=>{this._toolbarItems=this._toolbarItemRefs.toArray().map(e=>e.templateRef)}))}ngOnDestroy(){this._subscriptions.unsubscribe(),this._unsubscribeFromSubject(),this._refresh$.next(),this._refresh$.complete()}getDisplayValue(e,t){return _(this,null,function*(){return this._smartFilterBarService.getDisplayValue(e,t)})}showFilteringSettings(){let t={fields:this._getSubjectDefinitions(),filterBy:this.filterBy,selectedFilters:this.selectedFilters$()};this._dialogService.open(ke,Ae(G({},Si),{disablePaddings:!0,width:"50rem",data:t}),this._injector).afterClosed.pipe(N(1)).subscribe({next:n=>{this._setSelectedFilters(n)},error:()=>{}})}onSearchInputChange(e){this.search=e,this.searchInputChanged.emit(e)}cancelSearch(){this.search=void 0,this.liveUpdate&&this.submitForm()}submitForm(){this._formGenerator.submit()}setPreset(e){return _(this,null,function*(){this._ignorePresetChange=!0,e.filterBy=e.filterBy||[],this.filterBy=e.filterBy,this.search=e.search,this._refresh$.next(),this._refresh$.complete(),this._refresh$=new Le,this._formGeneratorReady.pipe(ze(t=>t),Ue(this._refresh$)).subscribe(()=>_(this,null,function*(){this._fgService.resetForm(this._formGenerator.form);for(let r of this.filterBy){let n=this._fgService.getFormControl(this._formGenerator.form,r.field);if(!n)continue;let m=n.formItem,p=this._smartFilterBarService.transformCollectionFilter(r),x=yield this._smartFilterBarService.getConditionFieldSelectedVariants(m,p);n?.setValue(x)}this._setSelectedFilters(this.filterBy.map(r=>r.field)),this.subject.getDataSource().dataProvider.setFilters(this.filterBy,this.search),this.subject.getSubject().fetch()}))})}getCurrentPreset(){return{search:this.search,filterBy:this.filterBy}}_onFormSubmitted(e){let t=this._generateCollectionFilterGroups(e);this._applyFiltering(t)}_onFormCreated(){this.subject&&this._setSelectedFilters([...this.subject.getDefaultFields(),...this.selectedFilters$()]),this._formGenerator.form.valueChanges.pipe(He(50),H(this._destroyRef)).subscribe(()=>_(this,null,function*(){let e=yield this.getFormattedConditions();this.smartFiltersChanged.emit({filterBy:e,search:this.search,subject:this.subject}),this.liveUpdate&&this._applyFiltering(e)})),this._formGeneratorReady.next(!0)}toggleFilterBar(){this.showFilterBar$.update(e=>!e)}getFormattedConditions(){return _(this,null,function*(){let e=yield this._fgService.getFormValue(this._formGenerator.form);return this._generateCollectionFilterGroups(e)})}_generateCollectionFilterGroups(e){let t=[],r=this._getSubjectDefinitions();return Object.entries(e).filter(([,n])=>!!n).forEach(([n,m])=>{let p=r.find(E=>E.name===n),x={filters:[],strategy:p.conditionStrategy,field:p.key};m.forEach(E=>{x.filters.push({strategy:E.operator,field:p.key,value:E.value,value2:E.value2,type:p.dataType})}),t.push(x)}),t.filter(n=>n.filters?.length>0)}_setSubject(e){e&&(this._subject=e,this.unsubscribeFromSubject(),this._listenToSubjectColumns())}unsubscribeFromSubject(){this._subject&&this._subjectSubscriptions.unsubscribe()}_listenToSubjectColumns(){this._subjectSubscriptions=new X,this._subjectSubscriptions.add(this._subject.fieldsStream.subscribe(e=>_(this,null,function*(){yield this._generateForm(e.filter(t=>t.filterable))})))}_generateForm(e){return _(this,null,function*(){let t=[],r=Fi(this.filtersColumnLayout??""),n=1;e.length!==0&&(e.forEach(m=>{let p=this._generateBaseFieldItem(m);switch(m.required&&this.selectedFilters$.update(x=>(x.push(m.name),x)),m.filterType){case K.SINGLE:case K.CATEGORY:p.guiOptions.additionalData.type="select",p.guiOptions.inline=!1;break;case K.MULTI:p.guiOptions.additionalData.type="multi-input";break;case K.CUSTOM:p=this._generateCustomFilterFieldItem(m,p);break;case K.INPUT:default:p=this._generateInputFieldItem(m,p);break}p.guiOptions.column=n,n+=1,n>r&&(n=1),t.push(p)}),this._formItems.set(t))})}_generateCustomFilterFieldItem(e,t){return e.customFilterType&&(t.guiOptions.additionalData.type=e.customFilterType,t.guiOptions.additionalData=Object.assign(t.guiOptions.additionalData,this._smartFilterBarService.getCustomFilterConfiguration(e.customFilterType)),t.type=t.guiOptions.additionalData.rendererComponent?`${t.guiOptions.additionalData.type}-renderer`:t.type,t.transformer=t.guiOptions.additionalData.valueTransformer),t}_generateInputFieldItem(e,t){switch(e.dataType){case $.DATE:t.guiOptions.additionalData.type="datepicker";break;case $.NUMBER:t.guiOptions.additionalData.controlType="number";break;case $.BOOLEAN:case $.STRING:default:t.guiOptions.additionalData.controlType="text";break}return t}_generateBaseFieldItem(e){return{name:e.name,message:e.label,required:e.required,type:Pe,placeholder:" ",validators:e.required?[bt.required]:[],choices:e.hasOptions?this._getFilterDefaultOptions(e.key,e.filterType):void 0,transformer:t=>Z(t),guiOptions:{additionalData:{type:"input",dataType:e.dataType,filterType:e.filterType,controlType:"text",choices:e.hasOptions?this._getFilterAvailableOptions(e.key):void 0}},when:()=>this.selectedFilters$().includes(e.name)}}_getFilterAvailableOptions(e){return()=>this._getFieldVariants(e)}_getFilterDefaultOptions(e,t){return()=>_(this,null,function*(){let r=yield re(this._getFieldVariants(e).pipe(N(1))),n=[];for(let m of r){let p={value:m.value,operator:"equalTo"};p.displayValue=yield this.getDisplayValue(p,t),n.push(p)}return n})}_getFieldVariants(e){return this.subject.getFieldVariants(e).pipe(N(1),Qe(t=>t.filter((r,n)=>t.findIndex(m=>m.value===r.value)===n)))}_getSubjectDefinitions(){return this.subject?.getSubjectFields()||[]}_applyFiltering(e){let t=this.subject.getDataSource();this.filterBy=e,t.dataProvider.setFilters(e,this.search),this.subject.getSubject().fetch();let r={search:this.search,filterBy:this.filterBy};this.smartFiltersApplied.emit(Ae(G({},r),{subject:this._subject})),this._ignorePresetChange||this.presetChanged.emit(r),this._ignorePresetChange=!1}_unsubscribeFromSubject(){this._subjectSubscriptions.unsubscribe(),this._subjectSubscriptions=new X}_setSelectedFilters(e){this.selectedFilters$.set(e.filter((t,r)=>e.indexOf(t)===r)),this._formGenerator.refreshStepsVisibility()}};i.\u0275fac=function(t){return new(t||i)(y(Ie),y(U),y(se),y(P))},i.\u0275cmp=R({type:i,selectors:[["fdp-smart-filter-bar"]],contentQueries:function(t,r,n){if(t&1&&fe(n,Ne,4),t&2){let m;V(m=j())&&(r._toolbarItemRefs=m)}},viewQuery:function(t,r){if(t&1&&z(W,5),t&2){let n;V(n=j())&&(r._formGenerator=n.first)}},hostAttrs:[1,"fdp-smart-filter-bar"],hostVars:2,hostBindings:function(t,r){t&2&&Ze("fdp-smart-filter-bar--transparent",r.transparent)},inputs:{subject:"subject",transparent:[I.HasDecoratorInputTransform,"transparent","transparent",O],filtersColumnLayout:"filtersColumnLayout",liveUpdate:[I.HasDecoratorInputTransform,"liveUpdate","liveUpdate",O],hideToolbar:[I.HasDecoratorInputTransform,"hideToolbar","hideToolbar",O]},outputs:{smartFiltersChanged:"smartFiltersChanged",smartFiltersApplied:"smartFiltersApplied",searchInputChanged:"searchInputChanged"},standalone:!0,features:[ue([vi,L,U,{provide:Dt,useExisting:i}]),le,Q,k],decls:2,vars:2,consts:[["fdType","transparent"],[1,"fdp-smart-filter-bar__filters"],[3,"inputChange","searchSubmit","cancelSearch","disabled","disableRefresh","placeholder"],["fd-button","","fdType","emphasized","fd-toolbar-item",""],["fd-button","","fd-toolbar-item","","glyph","synchronize",3,"click","disabled","ariaLabel"],["fd-button","","fd-toolbar-item","",3,"click","label","disabled"],["fd-button","","fdType","transparent","fd-toolbar-item","",3,"click","label","disabled"],[3,"ngTemplateOutlet"],["fd-button","","fdType","emphasized","fd-toolbar-item","",3,"click","disabled","label"],[1,"fdp-smart-filter-bar__filters",3,"hidden"],[3,"formCreated","formSubmitted","noAdditionalContent","formItems","columnLayout"]],template:function(t,r){if(t&1&&F(0,bi,12,22,"fd-toolbar",0)(1,Ci,2,4,"div",1),t&2){let n;B(0,r.hideToolbar?-1:0),s(),B(1,(n=r._formItems())?1:-1,n)}},dependencies:[gt,st,ht,Qt,_t,ye,ut,W,A],styles:[`.fdp-smart-filter-bar{display:block;box-shadow:var(--sapContent_HeaderShadow);background-color:var(--sapObjectHeader_Background)}.fdp-smart-filter-bar--transparent{background-color:var(--sapToolbar_Background);box-shadow:none}.fdp-smart-filter-bar .fd-toolbar--title{height:3rem;min-height:3rem;border-bottom:none;padding:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fd-toolbar--title{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-toolbar fdp-search-field{min-width:15.5rem}.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:.5rem;padding-right:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container{padding:0}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding-left:.25rem!important;padding-right:.25rem!important}.fdp-smart-filter-bar__conditions-dialog .fdp-smart-filter-bar__actions-column{min-width:auto;flex:0 0 auto}.fdp-smart-filter-bar__conditions-dialog .fd-popover-custom{display:block}.fdp-smart-filter-bar__conditions-dialog .fd-dialog__body{padding:0 .5rem;background-color:var(--sapBackgroundColor, #f7f7f7)}.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container,.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding-top:0!important;padding-bottom:0!important}.fdp-smart-filter-bar .fd-toolbar{--fdToolbar_Border: none}
`],encapsulation:2,changeDetection:0});let o=i;return o})();var tn={provide:ee,useExisting:ne(()=>te)};var cn=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=Ye({type:i}),i.\u0275inj=Ke({imports:[te,ke,Oe,Ee]});let o=i;return o})();export{L as a,Kt as b,$e as c,oi as d,Ne as e,te as f,tn as g,cn as h};
