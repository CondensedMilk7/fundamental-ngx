import{E as Gt,F as Nt,G as Pt,L as $t,N as qt,Q as Mt,c as H,d as A,e as Be,f as Et,l as xt,n as Rt,s as Vt,u as kt,w as At,x as Lt}from"./chunk-PC5ESRF3.js";import{a as Ot}from"./chunk-BHE4WSGA.js";import{Aa as bt,Ec as Bt,Fa as yt,Fc as Dt,Ga as St,Gc as It,Ha as Ct,Hc as wt,Nc as jt,Oa as Ft,Pc as U,hd as W,kd as Te,ub as vt,wa as J,zb as Tt}from"./chunk-62TC5Z23.js";import{b as st,r as lt,w as mt,y as x}from"./chunk-JENHLJN4.js";import{Ba as _t,E as fe,F as ue,Ka as ve,La as gt,M as he,N as _e,O as ge,Q as at,T as be,V as ye,Y as Se,ba as Ce,da as z,la as dt,oa as ct,pa as Fe,ra as pt,ua as ft,w as pe,ya as ut,za as ht}from"./chunk-PVTY2GRD.js";import{$a as He,Ab as y,Af as ot,Bc as M,Gb as ae,Hb as Ke,Ig as nt,K as $e,Kb as Y,Lb as Xe,Mb as Ye,Me as rt,P as qe,Pc as de,Qc as Q,R as G,Tb as se,Vc as it,Wb as E,Xb as Je,Yb as Ze,_a as N,a as ie,ab as P,ea as Me,eb as l,fb as p,fc as u,g as Le,gc as _,h as L,ha as oe,hc as et,ib as $,j as Ge,ja as Qe,ka as ze,lc as tt,na as Ue,nb as b,nc as w,ob as ne,oc as q,pb as a,pc as le,pd as k,qa as O,qb as d,qc as j,ra as We,rb as c,rc as me,s as Ne,sa as F,sb as S,tb as K,ub as X,wb as V,xf as ce,y as re,ya as D,yb as g,z as Pe,za as I}from"./chunk-6FDPAG7G.js";import{a as R,b as Re,g as h}from"./chunk-VIJJU4QR.js";var T=(()=>{let r=class r{constructor(e){this._fgService=e,this._customFilterConditions=new Map}addCustomFilter(e){if(!e.conditionComponent&&e.rendererComponent&&(e.conditionComponent=e.rendererComponent),!e.conditionComponent)return!1;let t=this._fgService.addComponent(e.conditionComponent,e.types);return t&&this._customFilterConditions.set(e.conditionComponent,e),t&&e.rendererComponent&&this._fgService.addComponent(e.rendererComponent,e.types.map(i=>`${i}-renderer`)),t}getCustomFilterConfiguration(e){let t=this._fgService.getComponentDefinitionByType(e);if(t)return this._customFilterConditions.get(t.component)}getApplicableFilterConditions(e,t=A.STRING){let i=this._fgService.getComponentDefinitionByType(e),n=Et(t);return i&&this._customFilterConditions.get(i.component)?.filterStrategies||n}getDisplayValue(e,t){return h(this,null,function*(){let i=this.getCustomFilterConfiguration(t);if(i?.valueRenderer){let f=i?.valueRenderer(e),B=ot(f),C;return yield B.createSubscription(f,xe=>{C=xe}),C}let n=this._normalizeValue(e.value),m=this._normalizeValue(e.value2);switch(e.operator){case"equalTo":return`=${n}`;case"contains":return`*${n}*`;case"between":return`${n}...${m}`;case"beginsWith":return`${n}*`;case"endsWith":return`*${n}`;case"greaterThan":return`>${n}`;case"greaterThanOrEqualTo":return`>=${n}`;case"lessThan":return`<${n}`;case"lessThanOrEqualTo":return`<=${n}`;case"after":return`>${n}`;case"onOrAfter":return`>=${n}`;case"before":return`<${n}`;case"beforeOrOn":return`<=${n}`;default:return`${n}`}})}normalizeConditions(e,t){return h(this,null,function*(){let i=[];for(let n of t){let m=Object.assign({},n);m.displayValue=yield this.getDisplayValue(m,e.guiOptions?.additionalData.type),i.push(m)}return i})}getConditionFieldSelectedVariants(e,t){return h(this,null,function*(){return(yield this.normalizeConditions(e,t)).map(i=>J(i)?i:{label:i.displayValue,value:i})})}transformCollectionFilter(e){return e.filters.map(t=>({operator:t.strategy,value:t.value,value2:t.value2}))}_normalizeValue(e){return Array.isArray(e)?e.map(t=>this._normalizeValue(t)).join(", "):J(e)?e.label:e instanceof Tt?e.toDateString():e}};r.\u0275fac=function(t){return new(t||r)(Ue(U))},r.\u0275prov=Qe({token:r,factory:r.\u0275fac});let o=r;return o})();function Z(o){return Array.isArray(o)&&(o=o.map(r=>Z(r))),J(o)?o.value:o}function Wt(o,r){if(o&1&&(d(0,"div",6)(1,"fd-bar-element")(2,"h4",7),Y(3),c()()()),o&2){let s=y();l(2),a("headerSize",4),l(1),Xe(s.config.header)}}function Ht(o,r){if(o&1){let s=V();d(0,"fd-layout-grid")(1,"div",9)(2,"div",10)(3,"fdp-form-generator",13),g("formSubmitted",function(t){D(s);let i=y(2);return I(i._onFormSubmitted(t))}),c()(),d(4,"div",14)(5,"fdp-button",15),g("click",function(){let i=D(s).index,n=y(2);return I(n.removeCondition(i))}),u(6,"fdTranslate"),c()()()()}if(o&2){let s=r.$implicit;l(3),a("formItems",s)("unifiedLayout",!1)("noAdditionalContent",!0),l(2),a("title",_(6,4,"platformSmartFilterBar.defineConditionsRemoveConditionButtonTitle"))}}function Kt(o,r){if(o&1){let s=V();d(0,"form"),b(1,Ht,7,6,"fd-layout-grid",8),d(2,"fd-layout-grid")(3,"div",9)(4,"div",10),Y(5,"\xA0"),c(),d(6,"div",11)(7,"fdp-button",12),g("click",function(){D(s);let t=y();return I(t.addCondition())}),u(8,"fdTranslate"),c()()()()()}if(o&2){let s=y();l(1),a("ngForOf",s._formItems),l(6),a("label",_(8,2,"platformSmartFilterBar.defineConditionsAddConditionButtonLabel"))}}function Xt(o,r){o&1&&(d(0,"div"),S(1,"fd-busy-indicator",16),c()),o&2&&(ae("text-align","center")("margin",1,"rem"),l(1),a("loading",!0))}var we=(()=>{let r=class r{constructor(e,t,i){this._dialogRef=e,this._cdr=t,this._smartFilterBarService=i,this.conditionOperatorOptions=[],this._formItems=[],this.loaded=!1,this._conditionLabelKeys={contains:"filterConditionContains",equalTo:"filterConditionEqualTo",between:"filterConditionBetween",beginsWith:"filterConditionBeginsWith",endsWith:"filterConditionEndsWith",lessThan:"filterConditionLessThan",lessThanOrEqualTo:"filterConditionLessThanOrEqualTo",greaterThan:"filterConditionGreaterThan",greaterThanOrEqualTo:"filterConditionGreaterThanOrEqualTo",after:"filterConditionAfter",onOrAfter:"filterConditionOnOrAfter",before:"filterConditionBefore",beforeOrOn:"filterConditionBeforeOrOn"},this._submittedForms=[],this.resolveTranslation=mt(),this._init()}_init(){this.config=this._dialogRef.data,this.conditionOperatorOptions=this._getApplicableConditionOperators(),this._addExistingConditions(Z(this.config.conditions)),this.config.conditions.length===0&&this.addCondition(),this.loaded=!0,this._cdr.markForCheck()}addCondition(){this._formItems.push(this._generateFormGeneratorItems())}removeCondition(e){this._formItems.splice(e,1),this._formItems.length===0&&this.addCondition()}applyConditions(){this._cdr.detectChanges(),this._submittedForms=[],this.formGenerators.toArray().forEach(e=>e.submit())}_onFormSubmitted(e){if(this._submittedForms.push(e),this._submittedForms.length!==this.formGenerators.length)return;let t=this._submittedForms.map(i=>(i.value=i.value1!==void 0?i.value1:i.value,i));this._dialogRef.close(t.filter(i=>i.value!==void 0&&i.value!==null))}_cancel(){this._dialogRef.dismiss()}_getApplicableConditionOperators(){let e=this._smartFilterBarService.getApplicableFilterConditions(this.config.filterType,this.config.dataType),t=R({},this._conditionLabelKeys);for(let i of Object.keys(this._conditionLabelKeys)){let n="platformSmartFilterBar."+t[i];t[i]=this.resolveTranslation(n)}return e.map(i=>({label:t[i],value:i}))}_addExistingConditions(e){e.forEach(t=>{let i=this._generateFormGeneratorItems(t);this._formItems.push(i)})}_generateFormGeneratorItems(e){return[{name:"operator",message:"operator",default:e?this.conditionOperatorOptions.find(t=>t.value===e.operator)?.value:this.conditionOperatorOptions[0].value,type:"select",choices:this.conditionOperatorOptions,required:!0,guiOptions:{inline:!1,column:1,noLabelLayout:!0}},{name:"value",message:"value",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValuePlaceholder"),controlType:this.config.controlType,when:t=>t.operator!==Be.BETWEEN,onchange:(t,i,n)=>{n.parent?.get("value1")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value1",message:"value1",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueFromPlaceholder"),controlType:this.config.controlType,when:t=>t.operator===Be.BETWEEN,onchange:(t,i,n)=>{n.parent?.get("value")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value2",message:"value2",default:e?.value2,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueToPlaceholder"),required:!0,controlType:this.config.controlType,when:t=>t?.operator===Be.BETWEEN,guiOptions:{inline:!1,column:3,noLabelLayout:!0}}]}};r.\u0275fac=function(t){return new(t||r)(p(fe),p(M),p(T))},r.\u0275cmp=O({type:r,selectors:[["fdp-smart-filter-bar-conditions-dialog"]],viewQuery:function(t,i){if(t&1&&q(W,5),t&2){let n;w(n=j())&&(i.formGenerators=n)}},standalone:!0,features:[E],decls:12,vars:8,consts:[[1,"fdp-smart-filter-bar__conditions-dialog"],["fdkTemplate","header"],[4,"ngIf","ngIfElse"],["fdType","emphasized",3,"label","click"],["fdType","transparent",3,"label","click"],["loadingTpl",""],["fd-bar-left",""],["fd-title","",3,"headerSize"],[4,"ngFor","ngForOf"],["fdLayoutGridRow",""],["colGrow","","fdLayoutGridCol",""],["fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],[3,"label","click"],["columnLayout","XL3-L3-M3-S3",3,"formItems","unifiedLayout","noAdditionalContent","formSubmitted"],["colGrow","","fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],["buttonType","transparent","glyph","decline","type","button",3,"title","click"],[3,"loading"]],template:function(t,i){if(t&1&&(d(0,"fd-dialog",0)(1,"fd-dialog-header"),b(2,Wt,4,2,"ng-template",1),c(),d(3,"fd-dialog-body"),b(4,Kt,9,4,"form",2),c(),d(5,"fd-dialog-footer")(6,"fd-button-bar",3),g("click",function(){return i.applyConditions()}),u(7,"fdTranslate"),c(),d(8,"fd-button-bar",4),g("click",function(){return i._cancel()}),u(9,"fdTranslate"),c()()(),b(10,Xt,2,5,"ng-template",null,5,me)),t&2){let n=ne(11);l(4),a("ngIf",i.loaded)("ngIfElse",n),l(2),a("label",_(7,4,"platformSmartFilterBar.defineConditionsSubmitButtonLabel")),l(2),a("label",_(9,6,"platformSmartFilterBar.defineConditionsCancelButton"))}},dependencies:[Ce,Se,ce,ge,_e,ye,ue,Q,ve,ft,Fe,pt,de,Ct,St,yt,W,Te,be,he,pe,x],encapsulation:2,changeDetection:0});let o=r;return o})();var Qt=(()=>{let r=class r extends Ft{constructor(e,t,i){super(),this._dialogService=e,this._smartFilterBarService=t,this._injector=i,this.openConditionsDialog=()=>{let n=this.getField().value,m={header:this.formItem.message,dataType:this.formItem.guiOptions?.additionalData.dataType,filterType:this.formItem.guiOptions?.additionalData.type,conditions:n||[],choices:this.formItem.guiOptions?.additionalData.choices,controlType:this.formItem.guiOptions?.additionalData.controlType};this._dialogService.open(we,{data:m,width:"67.5rem",minHeight:"30%"},this._injector).afterClosed.pipe(G(1)).subscribe({next:B=>h(this,null,function*(){let C=this.getField(),xe=yield this._smartFilterBarService.getConditionFieldSelectedVariants(this.formItem,B);C.setValue(xe)}),error:B=>{}})}}getField(){return this.form.get(`${this.formGroupName}.${this.name}`)}};r.\u0275fac=function(t){return new(t||r)(p(z),p(T),p(N))},r.\u0275dir=F({type:r,features:[$]});let o=r;return o})();var Ve=(()=>{let r=class r{constructor(){this.conditionStrategy="or",this._smartFilterBarFilterable=!0,this._required=!1,this._defaultSelected=!1,this._hasOptions=!1}set smartFilterBarFilterable(e){this._smartFilterBarFilterable=k(e)}get smartFilterBarFilterable(){return this._smartFilterBarFilterable}set required(e){this._required=k(e)}get required(){return this._required}set defaultSelected(e){this._defaultSelected=k(e)}get defaultSelected(){return this._defaultSelected}set hasOptions(e){this._hasOptions=k(e)}get hasOptions(){return this._hasOptions}};r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=F({type:r,selectors:[["","fdpSmartFilterBarFieldDefinition",""],["","fdp-smart-filter-bar-field-definition",""]],inputs:{key:"key",name:"name",label:"label",filterType:"filterType",dataType:"dataType",customFilterType:"customFilterType",conditionStrategy:"conditionStrategy",smartFilterBarFilterable:"smartFilterBarFilterable",required:"required",defaultSelected:"defaultSelected",hasOptions:"hasOptions"},standalone:!0});let o=r;return o})();var Yt=(()=>{let r=class r{constructor(e){this._subject=e,this._fieldDefinitionsSubject=new L([]),this.fieldsStream=this._fieldDefinitionsSubject.asObservable()}ngAfterViewInit(){this._fieldDefinitionsSubject.next(this._fieldDefinitions.toArray().map(e=>this._transformSubjectField(e))),this._fieldDefinitions.changes.subscribe(e=>{this._fieldDefinitionsSubject.next(e.map(t=>this._transformSubjectField(t)))})}getDataSource(){return this._subject.getDataSource()}getSubjectFields(){return this._fieldDefinitions.toArray().map(e=>this._transformSubjectField(e))}getFieldVariants(e){return this.getDataSource().dataProvider.getFieldOptions(e)}getDefaultFields(){return this.getSubjectFields()?.filter(e=>e.defaultSelected).map(e=>e.name)}getState(){return this._subject.getTableState()}getSubject(){return this._subject}_transformSubjectField(e){return{key:e.key,name:e.name,label:e.label,filterType:e.filterType,filterable:e.smartFilterBarFilterable,dataType:e.dataType,required:e.required,customFilterType:e.customFilterType,defaultSelected:e.defaultSelected,hasOptions:e.hasOptions,conditionStrategy:e.conditionStrategy}}};r.\u0275fac=function(t){return new(t||r)(p(kt))},r.\u0275dir=F({type:r,selectors:[["","fdpSmartFilterBarSubject",""],["","fdp-smart-filter-bar-subject",""]],contentQueries:function(t,i,n){if(t&1&&le(n,Ve,4),t&2){let m;w(m=j())&&(i._fieldDefinitions=m)}},exportAs:["fdp-smart-filter-bar-subject"],standalone:!0});let o=r;return o})();var ke=(()=>{let r=class r{constructor(e){this.templateRef=e}};r.\u0275fac=function(t){return new(t||r)(p(tt))},r.\u0275dir=F({type:r,selectors:[["","fdpSmartFilterBarToolbarItem",""]],standalone:!0});let o=r;return o})();var Jt=function(){return[]},je=(()=>{let r=class r extends Qt{constructor(e,t,i){super(e,t,i)}};r.\u0275fac=function(t){return new(t||r)(p(z),p(T),p(N))},r.\u0275cmp=O({type:r,selectors:[["fdp-smart-filter-bar-condition-field"]],standalone:!0,features:[$,E],decls:4,vars:13,consts:[[3,"formGroup"],[3,"formGroupName"],["displayKey","displayValue",3,"id","addOnButtonClickFn","autofocus","dataSource","formControlName","name","placeholder","glyphAriaLabel"]],template:function(t,i){t&1&&(K(0,0)(1,1),S(2,"fdp-multi-input",2),u(3,"fdTranslate"),X()()),t&2&&(a("formGroup",i.form),l(1),a("formGroupName",i.formGroupName),l(1),a("id",i.id)("addOnButtonClickFn",i.openConditionsDialog)("autofocus",!0)("dataSource",i.formItem.choices||Je(12,Jt))("formControlName",i.name)("name",i.name)("placeholder",i.formItem.placeholder||i.formItem.message)("glyphAriaLabel",_(3,10,"platformSmartFilterBar.manageFieldConditions")))},dependencies:[ve,ct,Fe,gt,ut,_t,ht,jt,x],encapsulation:2});let o=r;return o})();var Oe=class extends Rt{constructor(r){super(r)}filter(r){let s;switch(r){case"visible":s=this._getVisibleItems();break;case"active":s=this._getActiveItems();break;case"visibleAndActive":s=this._getVisibleAndActiveItems();break;case"mandatory":s=this._getMandatoryItems();break;case"all":default:s=this._getAllItems();break}this.items$.next(s)}_getAllItems(){return this.items}_getVisibleItems(){return this.items.filter(r=>r.visible)}_getActiveItems(){return this.items.filter(r=>r.active)}_getVisibleAndActiveItems(){return this.items.filter(r=>r.visible||r.active)}_getMandatoryItems(){return this.items.filter(r=>r.mandatory)}};var Zt=["table"];function ei(o,r){o&1&&(d(0,"div",6)(1,"fd-bar-element")(2,"h4",7),Y(3),u(4,"fdTranslate"),c()()(),d(5,"div",8)(6,"fd-bar-element"),S(7,"fdp-table-reset-button"),c()()),o&2&&(l(2),a("headerSize",4),l(1),Ye(" ",_(4,2,"platformSmartFilterBar.selectFiltersHeader")," "))}function ti(o,r){o&1&&S(0,"fd-icon",17)}function ii(o,r){if(o&1&&(d(0,"fdp-table-cell"),b(1,ti,1,0,"fd-icon",16),c()),o&2){let s=r.$implicit;l(1),a("ngIf",s.active)}}function ri(o,r){if(o&1){let s=V();d(0,"fdp-table",9,10),g("rowSelectionChange",function(t){D(s);let i=y();return I(i._onRowSelectionChange(t))}),d(2,"fdp-table-toolbar",11),u(3,"fdTranslate"),d(4,"fdp-table-toolbar-actions")(5,"fdp-select",12),g("selectionChange",function(t){D(s);let i=y();return I(i._onFilterVisibilityChange(t))}),c()()(),S(6,"fdp-column",13),u(7,"fdTranslate"),d(8,"fdp-column",14),u(9,"fdTranslate"),b(10,ii,2,1,"fdp-table-cell",15),c()()}if(o&2){let s=y();a("dataSource",s.source),l(2),a("hideItemCount",!1)("title",_(3,7,"platformSmartFilterBar.selectFiltersAvailableFiltersText")),l(3),a("list",s._filterVisibilityOptions)("value",s._filterVisibilityOptions[0].value),l(1),a("label",_(7,9,"platformSmartFilterBar.selectFiltersFilterColumnLabel")),l(2),a("label",_(9,11,"platformSmartFilterBar.selectFiltersActiveColumnLabel"))}}function oi(o,r){o&1&&(d(0,"div"),S(1,"fd-busy-indicator",18),c()),o&2&&(ae("text-align","center")("margin",1,"rem"),l(1),a("loading",!0))}var Ee=(()=>{let r=class r{constructor(e,t,i){this._dialogRef=e,this._language$=t,this._cdr=i,this._filterVisibilityOptions=[],this.loaded=!1,this._categoryLabelKeys={all:"settingsCategoryAll",visible:"settingsCategoryVisible",active:"settingsCategoryActive",visibleAndActive:"settingsCategoryVisibleAndActive",mandatory:"settingsCategoryMandatory"},this._selectedFilters=[],this._onDestroy$=new Le,this._isResetAvailableSubject$=new L(!1),this._translationResolver=new lt,this.isResetAvailable$=this._isResetAvailableSubject$.asObservable(),this.setInitialTableState(),this._init()}ngAfterViewInit(){this.setSelectedFilters()}setSelectedFilters(){this._sourceSubscription?.unsubscribe(),this._sourceSubscription=this.source.open().pipe(Ne(Ge),Me(this._onDestroy$)).subscribe(e=>{e.forEach((t,i)=>{t.visible&&this.table.toggleSelectableRow(i)})})}ngOnDestroy(){this._onDestroy$.next(),this._onDestroy$.complete()}reset(){this.setInitialTableState(),this.setSelectedFilters()}setInitialTableState(){this._availableFields=this._dialogRef.data.fields.filter(e=>e.filterable).map(e=>({label:e.label,active:!!this._dialogRef.data.filterBy.find(t=>t.field===e.name),mandatory:e.required,visible:this._dialogRef.data.selectedFilters.includes(e.name),key:e.key,name:e.name})),this.source=new xt(new Oe(this._availableFields))}_cancel(){this._dialogRef.dismiss()}_confirm(){this._dialogRef.close(this._selectedFilters)}_onRowSelectionChange(e){this._selectedFilters=e.selection.map(t=>t.name),this._isResetAvailableSubject$.next(!0)}_onFilterVisibilityChange(e){this.table&&(this.source.dataProvider.filter(e.payload),this.source.fetch(this.table.getTableState()))}_init(){return h(this,null,function*(){yield this._transformVisibilityLabels(),this.loaded=!0,this._cdr.markForCheck()})}_transformVisibilityLabels(){return h(this,null,function*(){let e=yield re(this._language$),t=R({},this._categoryLabelKeys);for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let n="platformSmartFilterBar."+t[i];t[i]=this._translationResolver.resolve(e,n)}for(let[i,n]of Object.entries(t))this._filterVisibilityOptions.push({label:n,value:i})})}};r.\u0275fac=function(t){return new(t||r)(p(fe),p(st),p(M))},r.\u0275cmp=O({type:r,selectors:[["fdp-smart-filter-bar-settings-dialog"]],viewQuery:function(t,i){if(t&1&&q(Zt,5),t&2){let n;w(n=j())&&(i.table=n.first)}},standalone:!0,features:[se([{provide:Gt,useExisting:r}]),E],decls:12,vars:8,consts:[[1,"fdp-table-p13-filtering-dialog"],["fdkTemplate","header"],["selectionMode","multiple",3,"dataSource","rowSelectionChange",4,"ngIf","ngIfElse"],["fdType","emphasized",3,"label","click"],["fdType","transparent",3,"label","click"],["loadingTpl",""],["fd-bar-left",""],["fd-title","",3,"headerSize"],["fd-bar-right",""],["selectionMode","multiple",3,"dataSource","rowSelectionChange"],["table",""],[3,"hideItemCount","title"],[3,"list","value","selectionChange"],["align","start","key","label","name","label",3,"label"],["align","center","key","active","name","active","width","150px",3,"label"],[4,"fdpCellDef"],["glyph","accept",4,"ngIf"],["glyph","accept"],[3,"loading"]],template:function(t,i){if(t&1&&(d(0,"fd-dialog",0)(1,"fd-dialog-header"),b(2,ei,8,4,"ng-template",1),c(),d(3,"fd-dialog-body"),b(4,ri,11,13,"fdp-table",2),c(),d(5,"fd-dialog-footer")(6,"fd-button-bar",3),g("click",function(){return i._confirm()}),u(7,"fdTranslate"),c(),d(8,"fd-button-bar",4),g("click",function(){return i._cancel()}),u(9,"fdTranslate"),c()()(),b(10,oi,2,5,"ng-template",null,5,me)),t&2){let n=ne(11);l(4),a("ngIf",i.loaded)("ngIfElse",n),l(2),a("label",_(7,4,"platformSmartFilterBar.selectFiltersSubmitButtonLabel")),l(2),a("label",_(9,6,"platformSmartFilterBar.selectFiltersCancelButton"))}},dependencies:[Ce,Se,ce,ge,_e,ye,at,Nt,ue,Q,Mt,Vt,qt,$t,vt,Pt,Lt,At,nt,be,he,pe,x],encapsulation:2,changeDetection:0});let o=r;return o})();var Ae="smart-filter-condition-renderer";var ee=(()=>{let r=class r{constructor(){this.name="platformSmartFilterBar",this.presetChanged=new P}};r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=F({type:r,inputs:{name:"name"},outputs:{presetChanged:"presetChanged"}});let o=r;return o})();function ni(o,r){}function ai(o,r){if(o&1&&(K(0),b(1,ni,0,0,"ng-template",10),S(2,"fd-toolbar-separator"),X()),o&2){let s=r.$implicit;l(1),a("ngTemplateOutlet",s)}}function si(o,r){if(o&1&&(K(0),b(1,ai,3,1,"ng-container",9),X()),o&2){let s=y();l(1),a("ngForOf",s._toolbarItems)}}function li(o,r){if(o&1){let s=V();d(0,"fdp-button",11),g("click",function(){D(s);let t=y();return I(t.submitForm())}),u(1,"fdTranslate"),c()}if(o&2){let s=y();a("disabled",s._loading)("label",_(1,2,"platformSmartFilterBar.submitButtonLabel"))}}var mi=function(o){return{filtersCount:o}},di="XL4-L3-M2-S1";function ci(o){return Math.max(...o.split("-").map(r=>{let s=r.match(/\d+/);return s?parseInt(s[0],10):1}))}var pi={responsivePadding:!0,verticalPadding:!0,minWidth:"30rem",bodyMinHeight:"calc(50vh - 88px)"},fi={provide:ee,useExisting:oe(()=>te)},te=(()=>{let r=class r extends ee{set subject(e){this._setSubject(e)}get subject(){return this._subject}set transparent(e){this._transparent=k(e)}get transparent(){return this._transparent}get _loading(){return this._subject?.getDataSource()?this._subject.getDataSource().isDataLoading:!0}constructor(e,t,i,n,m,f){super(),this._dialogService=e,this._cdr=t,this._smartFilterBarService=i,this._fgService=n,this._injector=m,this._destroyRef=f,this.filtersColumnLayout=di,this.liveUpdate=!1,this.smartFiltersChanged=new P,this.smartFiltersApplied=new P,this.searchInputChanged=new P,this.filterBy=[],this._toolbarItems=[],this._selectedFilters=[],this._showFilterBar=!0,this._subscriptions=new ie,this._subjectSubscriptions=new ie,this._transparent=!1,this._formGeneratorReady=new L(!1),this._ignorePresetChange=!1,this._fgService.addComponent(je,[Ae])}ngAfterViewInit(){this._toolbarItems=this._toolbarItemRefs.toArray().map(e=>e.templateRef),this._toolbarItemRefs.changes.subscribe(()=>{this._toolbarItems=this._toolbarItemRefs.toArray().map(e=>e.templateRef)})}ngOnDestroy(){this._subscriptions.unsubscribe(),this._unsubscribeFromSubject()}getDisplayValue(e,t){return h(this,null,function*(){return this._smartFilterBarService.getDisplayValue(e,t)})}showFilteringSettings(){let t={fields:this._getSubjectDefinitions(),filterBy:this.filterBy,selectedFilters:this._selectedFilters};this._dialogService.open(Ee,Re(R({},pi),{disablePaddings:!0,width:"50rem",data:t}),this._injector).afterClosed.pipe(G(1)).subscribe(n=>{this._setSelectedFilters(n)})}_onSearchInputChange(e){this.search=e,this.searchInputChanged.emit(e)}_cancelSearch(){this.search=void 0,this.liveUpdate&&this.submitForm()}submitForm(){this._formGenerator.submit()}setPreset(e){return h(this,null,function*(){this._ignorePresetChange=!0,e.filterBy=e.filterBy||[],this.filterBy=e.filterBy,this.search=e.search,this._formGeneratorReady.pipe($e(t=>t)).subscribe(()=>h(this,null,function*(){this._fgService.resetForm(this._formGenerator.form);for(let i of this.filterBy){let n=this._fgService.getFormControl(this._formGenerator.form,i.field);if(!n)continue;let m=n.formItem,f=this._smartFilterBarService.transformCollectionFilter(i),B=yield this._smartFilterBarService.getConditionFieldSelectedVariants(m,f);n?.setValue(B)}this._setSelectedFilters(this.filterBy.map(i=>i.field)),this.subject.getDataSource().dataProvider.setFilters(this.filterBy,this.search),this.subject.getSubject().fetch()}))})}getCurrentPreset(){return{search:this.search,filterBy:this.filterBy}}_onFormSubmitted(e){let t=this._generateCollectionFilterGroups(e);this._applyFiltering(t)}_onFormCreated(){this.subject&&this._setSelectedFilters([...this.subject.getDefaultFields(),...this._selectedFilters]),this._formGenerator.form.valueChanges.pipe(qe(50),rt(this._destroyRef)).subscribe(()=>h(this,null,function*(){let e=yield this.getFormattedConditions();this.smartFiltersChanged.emit({filterBy:e,search:this.search,subject:this.subject}),this.liveUpdate&&this._applyFiltering(e)})),this._formGeneratorReady.next(!0)}_toggleFilterBar(){this._showFilterBar=!this._showFilterBar,this._cdr.markForCheck()}getFormattedConditions(){return h(this,null,function*(){let e=yield this._fgService.getFormValue(this._formGenerator.form);return this._generateCollectionFilterGroups(e)})}_generateCollectionFilterGroups(e){let t=[],i=this._getSubjectDefinitions();return Object.entries(e).filter(([,n])=>!!n).forEach(([n,m])=>{let f=i.find(C=>C.name===n),B={filters:[],strategy:f.conditionStrategy,field:f.key};m.forEach(C=>{B.filters.push({strategy:C.operator,field:f.key,value:C.value,value2:C.value2,type:f.dataType})}),t.push(B)}),t.filter(n=>n.filters?.length>0)}_setSubject(e){e&&(this._subject=e,this.unsubscribeFromSubject(),this._listenToSubjectColumns())}unsubscribeFromSubject(){this._subject}_listenToSubjectColumns(){this._subjectSubscriptions.add(this._subject.fieldsStream.subscribe(e=>h(this,null,function*(){setTimeout(()=>h(this,null,function*(){yield this._generateForm(e.filter(t=>t.filterable))}))})))}_generateForm(e){return h(this,null,function*(){let t=[],i=ci(this.filtersColumnLayout??""),n=1;e.length!==0&&(e.forEach(m=>{let f=this._generateBaseFieldItem(m);switch(m.required&&this._selectedFilters.push(m.name),m.filterType){case H.SINGLE:case H.CATEGORY:f.guiOptions.additionalData.type="select",f.guiOptions.inline=!1;break;case H.MULTI:f.guiOptions.additionalData.type="multi-input";break;case H.CUSTOM:f=this._generateCustomFilterFieldItem(m,f);break;case H.INPUT:default:f=this._generateInputFieldItem(m,f);break}f.guiOptions.column=n,n+=1,n>i&&(n=1),t.push(f)}),this._formItems=t,this._cdr.detectChanges())})}_generateCustomFilterFieldItem(e,t){return e.customFilterType&&(t.guiOptions.additionalData.type=e.customFilterType,t.guiOptions.additionalData=Object.assign(t.guiOptions.additionalData,this._smartFilterBarService.getCustomFilterConfiguration(e.customFilterType)),t.type=t.guiOptions.additionalData.rendererComponent?`${t.guiOptions.additionalData.type}-renderer`:t.type,t.transformer=t.guiOptions.additionalData.valueTransformer),t}_generateInputFieldItem(e,t){switch(e.dataType){case A.DATE:t.guiOptions.additionalData.type="datepicker";break;case A.NUMBER:t.guiOptions.additionalData.controlType="number";break;case A.BOOLEAN:case A.STRING:default:t.guiOptions.additionalData.controlType="text";break}return t}_generateBaseFieldItem(e){return{name:e.name,message:e.label,required:e.required,type:Ae,placeholder:" ",validators:e.required?[dt.required]:[],choices:e.hasOptions?this._getFilterDefaultOptions(e.key,e.filterType):void 0,transformer:t=>Z(t),guiOptions:{additionalData:{type:"input",dataType:e.dataType,filterType:e.filterType,controlType:"text",choices:e.hasOptions?this._getFilterAvailableOptions(e.key):void 0}},when:()=>this._selectedFilters.includes(e.name)}}_getFilterAvailableOptions(e){return()=>this._getFieldVariants(e)}_getFilterDefaultOptions(e,t){return()=>h(this,null,function*(){let i=yield re(this._getFieldVariants(e).pipe(G(1))),n=[];for(let m of i){let f={value:m.value,operator:"equalTo"};f.displayValue=yield this.getDisplayValue(f,t),n.push(f)}return n})}_getFieldVariants(e){return this.subject.getFieldVariants(e).pipe(G(1),Pe(t=>t.filter((i,n)=>t.findIndex(m=>m.value===i.value)===n)))}_getSubjectDefinitions(){return this.subject?.getSubjectFields()||[]}_applyFiltering(e){let t=this.subject.getDataSource();this.filterBy=e,t.dataProvider.setFilters(e,this.search),this.subject.getSubject().fetch();let i={search:this.search,filterBy:this.filterBy};this.smartFiltersApplied.emit(Re(R({},i),{subject:this._subject})),this._ignorePresetChange||this.presetChanged.emit(i),this._ignorePresetChange=!1}_unsubscribeFromSubject(){this._subjectSubscriptions.unsubscribe(),this._subjectSubscriptions=new ie}_setSelectedFilters(e){this._selectedFilters=e.filter((t,i)=>e.indexOf(t)===i),this._formGenerator.refreshStepsVisibility()}};r.\u0275fac=function(t){return new(t||r)(p(z),p(M),p(T),p(U),p(N),p(He))},r.\u0275cmp=O({type:r,selectors:[["fdp-smart-filter-bar"]],contentQueries:function(t,i,n){if(t&1&&le(n,ke,4),t&2){let m;w(m=j())&&(i._toolbarItemRefs=m)}},viewQuery:function(t,i){if(t&1&&q(W,5),t&2){let n;w(n=j())&&(i._formGenerator=n.first)}},hostAttrs:[1,"fdp-smart-filter-bar"],hostVars:2,hostBindings:function(t,i){t&2&&Ke("fdp-smart-filter-bar--transparent",i.transparent)},inputs:{subject:"subject",transparent:"transparent",filtersColumnLayout:"filtersColumnLayout",liveUpdate:"liveUpdate"},outputs:{smartFiltersChanged:"smartFiltersChanged",smartFiltersApplied:"smartFiltersApplied",searchInputChanged:"searchInputChanged"},standalone:!0,features:[se([fi,T,U,{provide:bt,useExisting:r}]),$,E],decls:15,vars:26,consts:[["fdType","transparent"],[4,"ngIf"],[3,"disabled","disableRefresh","placeholder","inputChange","searchSubmit","cancelSearch"],["buttonType","emphasized","fd-toolbar-item","",3,"disabled","label","click",4,"ngIf"],["fd-toolbar-item","","glyph","synchronize",3,"disabled","ariaLabel","click"],["fd-toolbar-item","",3,"label","disabled","click"],["buttonType","transparent","fd-toolbar-item","",3,"label","disabled","click"],[1,"fdp-smart-filter-bar__filters",3,"hidden"],[3,"noAdditionalContent","formItems","columnLayout","formCreated","formSubmitted"],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet"],["buttonType","emphasized","fd-toolbar-item","",3,"disabled","label","click"]],template:function(t,i){t&1&&(d(0,"div")(1,"fd-toolbar",0),b(2,si,2,1,"ng-container",1),d(3,"fdp-search-field",2),g("inputChange",function(m){return i._onSearchInputChange(m)})("searchSubmit",function(){return i.submitForm()})("cancelSearch",function(){return i._cancelSearch()}),u(4,"fdTranslate"),c(),S(5,"fd-toolbar-spacer"),b(6,li,2,4,"fdp-button",3),d(7,"fdp-button",4),g("click",function(){return i.submitForm()}),u(8,"fdTranslate"),c(),d(9,"fdp-button",5),g("click",function(){return i.showFilteringSettings()}),u(10,"fdTranslate"),c(),d(11,"fdp-button",6),g("click",function(){return i._toggleFilterBar()}),u(12,"fdTranslate"),c()()(),d(13,"div",7)(14,"fdp-form-generator",8),g("formCreated",function(){return i._onFormCreated()})("formSubmitted",function(m){return i._onFormSubmitted(m)}),c()()),t&2&&(l(2),a("ngIf",i._toolbarItems),l(1),a("disabled",i._loading)("disableRefresh",!0)("placeholder",_(4,15,"platformSmartFilterBar.searchPlaceholder")),l(3),a("ngIf",!i.liveUpdate),l(1),a("disabled",i._loading)("ariaLabel",_(8,17,"platformSmartFilterBar.refreshButtonAriaLabel")),l(2),a("label",et(10,19,"platformSmartFilterBar.filtersButtonLabel",Ze(24,mi,i._selectedFilters.length)))("disabled",i._loading),l(2),a("label",_(12,22,i._showFilterBar?"platformSmartFilterBar.hideFiltersButtonLabel":"platformSmartFilterBar.showFiltersButtonLabel"))("disabled",i._loading),l(2),a("hidden",!i._showFilterBar),l(1),a("noAdditionalContent",!0)("formItems",i._formItems)("columnLayout",i.filtersColumnLayout))},dependencies:[It,Q,de,it,Bt,Ot,Dt,Te,wt,W,x],styles:[`.fdp-smart-filter-bar{display:block;box-shadow:var(--sapContent_HeaderShadow);background-color:var(--sapObjectHeader_Background)}.fdp-smart-filter-bar--transparent{background-color:var(--sapToolbar_Background);box-shadow:none}.fdp-smart-filter-bar .fd-toolbar--title{height:3rem;min-height:3rem;border-bottom:none;padding:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fd-toolbar--title{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-toolbar fdp-search-field{min-width:15.5rem}.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:.5rem;padding-right:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container{padding:0}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding-left:.25rem!important;padding-right:.25rem!important}.fdp-smart-filter-bar__conditions-dialog .fdp-smart-filter-bar__actions-column{min-width:auto;flex:0 0 auto}.fdp-smart-filter-bar__conditions-dialog .fd-popover-custom{display:block}.fdp-smart-filter-bar__conditions-dialog .fd-dialog__body{padding:0 .5rem;background-color:var(--sapBackgroundColor, #f7f7f7)}.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container,.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding:0!important}
`],encapsulation:2,changeDetection:0});let o=r;return o})();var qo=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=We({type:r}),r.\u0275inj=ze({imports:[te,Ee,we,je]});let o=r;return o})();var Wo={provide:ee,useExisting:oe(()=>te)};export{T as a,Qt as b,Ve as c,Yt as d,ke as e,te as f,qo as g,Wo as h};
